#! /usr/bin/env perl

use strict;

# Taint.  /usr/bin/env can't do it for us.
exec $^X, (map {( -I => $_)} @INC), -T => $0, @ARGV unless ${^TAINT};

# app.psgi
use Plack::App::Directory;
my ($root) = (shift @ARGV) =~ /^(.*)$/;  # untaint - we trust ARGV
die "Syntax: $0 <webroot-dir> [... plackup args ]\n\nServe a directory via plackup.  root=$root\n"
  unless defined $root && -d $root && -r _;
my $app = Plack::App::Directory->new({ root => $root })->to_app;

# bin/plackup
use Plack::Runner;
my $runner = Plack::Runner->new(app => $app);
$runner->parse_options(@ARGV);
$runner->run;
